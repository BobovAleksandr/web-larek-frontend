# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```
или
```
yarn
yarn start
```
## Сборка
```
npm run build
```
или
```
yarn build
```

# Базовый код

В архитектуре приложения используется паттерн MVP, без выделения презентера в отдельный класс. 

## Слои:
1. Модель данных (хранение и изменение данных) 
2. Отображение данных
3. Презентер для соединения модели с отображением

---

# Слой данных

## Константы 
В файле `constants.ts` объявлены константы с адресами запросов API, ендпоинтами для запросов, регулярными выражениями для проверки валидации форм.

## Типы и интерфейсы

### Тип Payment
Тип определяет варианты оплаты товара.

### Тип Category
Тип определяет список категорий товаров.

### Тип OrderFormData
Тип определяет формат данных, отправляемых из формы с адресом и способом оплаты.

### Тип ContactsFormData
Тип определяет формат данных, отправляемых из формы с номером телефона и email.

### Тип ApiPostMethods
Тип хранит варианты запросов на сервер через API.

### Интерфейс IProduct
Интерфейс определяет вид объекта товара.

### Интерфейс IOrder
Интерфейс определяет вид объекта заказа.

## Классы

### Класс ProductList
Класс хранит массив товаров, полученный с сервера. Конструктор класса принимает инстанс класса `EventEmitter` для создания событий.

Поля и методы класса:
1. `_products` - поле класса для хранения массива товаров.
2. `_selectedProduct` - поле класса для хранения текущего выбранного товара.
3. `selectedProduct` - геттер и сеттер для записи и получения текущего выбранного товара.
4. `setCatalog(items: IProduct[]): void` - метод для сохранения товаров в поле `_products`.

### Класс Basket
Класс для создания объекта корзины. Хранит массив товаров, находящихся в корзине. Конструктор класса принимает инстанс класса `EventEmitter` для создания событий.

Поля и методы класса:
1. `_basketProducts` - поле класса для хранения массива товаров, находящихся в корзине.
2. `products` - геттер, возвращает массив товаров, находящихся в корзине.
3. `basketInit(): void` - метод инициализирует корзину. Создаёт событие для открытия корзины. Если в корзине есть товары, создёт событие изменения корзины.
4. `toggleBasketProduct(product: IProduct): void` - метод для добавления товара в корзину и удаления товара из корзины. В параметрах принимает объект товара. Если товар есть в корзине - удаляет, если нет - добавляет.
5. `isProductInBasket(product: IProduct): boolean` - метод для проверки нахождения товара в корзине. Принимает объект товара. Если товар есть в корзине - возвращает `true`.
6. `totalBasketPrice(): number` - приватный геттер, который возвращает общую сумму товаров в корзине.
7. `clearBasket(): void` - метод очищает корзину.


### Класс Order
Класс для создания объекта заказа. Хранит информацию о свойствах заказа и id товаров в заказе. Конструктор класса принимает инстанс класса `EventEmitter` для создания событий.

Поля и методы класса:
1. `basketData(data: { items: IProduct[] })` - сеттер для сохранения id товаров и суммы заказа в полях класса. Принимает массив товаров.
2. `orderData(data: { payment: Payment, address: string })` - сеттер для сохранения данных из формы с типом оплаты и адресом в поля класса.
3. `contactsData(data: { phone: string, email: string })` - сеттер для сохранения данных из формы с номером телефона и email в поля класса.
4. `clearOrder(): void` - метод очищает данные в полях класса.
5. `get order(): IOrder` - метод возвращает объект заказа.

### Класс Validator
Класс для создания валидатора. Инстанс класса содержит методы для проверки валидации форм. Методы генерируют сообщения об ошибках валидации и статус валидации, создавая событие с объектом данных валидации для передачи в формы. Конструктор класса принимает инстанс класса `EventEmitter` для создания событий.

Поля и методы класса:
1. `checkOrderForm(data: OrderFormData): void` - метод для проверки валидации формы с типом оплаты и адресом. Принимает объект с данными о полях формы.
2. `checkContactsFormValid(data: ContactsFormData): void` - метод для проверки валидации формы с номером телефона и email. Принимает объект с данными о полях формы.

---

# Слой отображения
Слой отображения отвечает за отображение и изменение элементов на странице. Содержит классы элементов DOM-дерева и шаблоны.

## Константы 
В файле `constants.ts` объявлены константы категориями карт для формирования селекторов, шаблоны HTML-элементов, переменную с текущей валютой.

## Классы

### Класс Component
Абстрактный класс для наследования другими классами. Содержит базовые методы, которые могут быть использованы в любых классах компонентов отображения. Конструктор класса принимает HTML-элемент контейнера контента и инстанс класса `EventEmitter` для создания событий.

Поля и методы класса:
1. `setImage(element: HTMLImageElement, src: string, alt: string): void` - метод устанавливает ссылку на изображение и alt-текст. Принимает элемент, ссылку и текст.
2. `setDisabled(element: HTMLElement, state: boolean): void` - метод для переключения атрибута `disabled` у элемента. Принимает элемент и булево значение, при `true` - устанавливает атрибут `disabled`.
3. `render(data?: object): HTMLElement` - метод возвращает HTML-элемент инстанса класса. Опциаонально принимает объект для редактирования свойств элементов экземпляров дочерних классов. 
4. `cloneTemplate(template: HTMLTemplateElement): HTMLElement` - метод возвращает HTML-элемент на основании принимаемого шаблона.

### Класс Page
Класс для создания компонента страницы, расширяет класс `Component`. Содержит контейнер для рендера карточек товаров, элемент иконки корзины. Конструктор класса принимает HTML-элемент контейнера контента и инстанс класса `EventEmitter` для создания событий.

Поля и методы класса:
1. `basketCounter(value: string)` - сеттер для смены значения счётчика иконки корзины, принимает новое значение для счётчика.
2. `setCatalog(items: HTMLElement[]): void` - метод для добавления HTML-элементов в контейнер для карточек товаров. Принимает массив элементов.
3. `lockPage(value: boolean): void` - блокирует / разблокирует скролл страницы, принимает булево значение. При `true` - блокирует.

### Класс Card
Абстрактный класс для карточки товара, расширяет класс `Component`. Класс содержит базовые элементы - общие для всех видов карточек товара - заголовок и стоимость товара, а так же поле для хранения текущего объекта товара. Конструктор класса принимает HTML-элемент контейнера контента и инстанс класса `EventEmitter` для создания событий.

Единственный метод класса - `render(product: IProduct): HTMLElement` - расширяет метод класса `Component`. Принимает объект товара, устанавливает заголовок и стоимость, сохраняет товар в соответствующем поле, возвращает HTML-элемент карточки.

### Класс CardBasket
Класс для карточки товара в корзине, расширяет класс `Card`. Конструктор родительского класса. Класс содержит поля для карточки товара в корзине - порядковый номер, кнопку, создаёт слушатель клика для кнопки.

`index(value: number)` - сеттер, принимает значение порядкового номера товара в корзине и записывает в соответствующий элемент.

### Класс CardCatalog
Класс для карточки товара в каталоге на главной странице, расширяет класс `Card`. Конструктор родительского класса. Класс содержит поля для изображения и категории товара. 

Метод `render(product: IProduct): HTMLElement` расширяется от родительского, принимает объект товара, устанавливает изображение и категорию товара, возвращает HTML-элемент карточки.

### Класс CardPreview
Класс для подробной карточки товара, расширятся от класса `CardCatalog`. Конструктор родительского класса. Класс содержит поля для изображения, категории, описания и кнопки, создаёт слушатель клика для кнопки.

Поля и методы класса:
1. `changeButtonText(isInBasket: boolean)` - меняет текст кнопки в карточке, принимая булево значение. При `true` - 'Убрать из корзины', при `false` - 'В корзину'
2. Метод `render(product: IProduct): HTMLElement` расширяется от родительского, принимает объект товара, устанавливает описание, категорию, изображение, меняет вид кнопки карточки, возвращает HTML-элемент карточки.

### Класс BasketComponent
Класс для корзины, расширяет класс `Component`. Класс содержит поля: контейнер для рендера карточек товара, заголовок, цену и кнопку, а также создаёт слушатель клика для кнопки. Конструктор класса принимает HTML-элемент контейнера контента и инстанс класса `EventEmitter` для создания событий.

Поля и методы класса:
1. `content(items: HTMLElement[])` - сеттер для добавления HTML-элементов в контейнер для карточек товаров. Принимает массив карточек товаров.
2. `totalPrice(value: number)` - сеттер для смены значения итоговой суммы товаров в корзине, принимает новое значение.
3. `toggleButtonState(isBasketPositive: boolean): void` - метод для блокировки кнопки. Принимает булево значение, при `true` - блокирует.

### Класс Modal
Класс для модального окна, , расширятся от класса `Component`. Содержит поля для элементов, кнопки закрытия, а также создаёт слушатель нажатия кнопки закрытия, бэкдропа и клавиши Esc для закрытия модального окна Конструктор родительского класса. 

Поля и методы класса:
1. `content(value: HTMLElement)` - сеттер, устанавливает элементы в контейнер контента, принимает HTML-элемент.
2. `open(): void` и `close(): void` - методы для открытия и закрытия модального окна.
3. `render(): HTMLElement` - метод расширяет родительский, добавляя вызов метода открытия модального окна.

### Класс Form
Абстрактный класс для форм, расширяет класс `Component`. Класс содержит базовые для всех элементов форм поля: массив инпутов, кнопка сабмита, блок для ошибок. Конструктор родительского класса, а так же устанавливает слушатель на изменение значений полей ввода и сабмит формы.

Поля и методы класса:
1. `valid(value: boolean)` - сеттер, разблокирующий кнопку сабмита формы. Принимает булево значение, при `true` - разблокирует.
2. `errors(value: string)` - сеттер, устанавливает текст ошибки в соответствующее поле класса. Принимает текст ошибки.
3. `formSubmit(e: Event): void` - базовый метод сабмита формы для расширения дочерними классами. Выключает поведение браузера по умолчанию при сабмите.
4. `handleFormChange(): void` - абстрактный метод для расширения в дочерних классах, вызывается при изменении элементов формы.

### Класс OrderForm
Класс для формы с выбором типа оплаты и адресом, расширяет класс `Form`. Содержит поля для элементов кнопок выбора оплаты, инпута адреса, и активной кнопки (выбранного способа оплаты). Конструктор родительского класса, а также устанавливает на кнопки слушатель клика, который выключает одну кнопку при нажатии другой.

Поля и методы класса:
1. `handleFormChange(): void` - метод создаёт событие изменения формы, передавая значения элементов формы, расширяет родительский абстрактный метод.
2. `formSubmit(e: Event): void` - метод сабмита формы, расширяет родительский, создаёт событие сабмита формы, передавая значения элементов формы.

### Класс ContactsForm
Класс для формы с email и номером телефона, расширяет класс `Form`. Содержит поля для элементов инпутов email и номера телефона. Конструктор родительского класса.

Поля и методы класса:
1. `handleFormChange(): void` - метод создаёт событие изменения формы, передавая значения элементов формы, расширяет родительский абстрактный метод.
2. `formSubmit(e: Event): void` - метод сабмита формы, расширяет родительский, создаёт событие сабмита формы, передавая значения элементов формы.

### Класс Success
Класс для элемента с информацией об успешном оформлении заказа, расширяет класс `Component`. Содержит поля для элементов описания и кнопки закрытия. Конструктор родительского класса, также создает слушатель клика по кнопке.

Единственный метод - `render(data: { value: number })` - расширяет родительский, принимает сумму товаров в заказе для отображения в окне.

---

# Слой презентера
Код взаимодействия слоев представления и данных находится в файле `index.ts`. Презентер представляет собой экземпляр класса `EventEmitter`, методы которого позволяют установить обработчик на кастомное событие, вызываемое, снять обработчик, инициировать событие с данными.

Взаимодействие слоя данных и слоя представления осуществляется за счет событий, генерируемых EventEmitter'ом и обработчиками, описанными в `index.ts`

В `index.ts` создаются экземпляры необходимых классов и настраивается обработка событий.

## События, генерируемые моделью данных:
`catalog:changed` - изменение массива товаров в модели данных.\
`product:selected` - выбор текущего продукта.\
`card:productChanged` - изменение корзины (при просмотре окна карточки товара).\
`basketAmount:Changed` - изменение количества товаров в корзине.\
`basket:init` - инициализация корзины.\
`basket:changed` - изменение состава корзины.\
`basketData:changed` - добавление данных о товарах в заказ.\
`orderForm:checked` - проверка валидности элементов формы со способом оплаты и адресом. \
`orderFormData:changed` - добавление данных из формы со способом оплаты и адресом в заказ.\
`contactsForm:checked` - проверка валидности элементов формы с email и номером телефона. \
`order:error` - ошибка отправки заказа на сервер.\
`order:sent` - успешная отправка заказа на сервер.\
`basket:cleared` - корзина очищена.

## События, генерируемые пользвателем при взаимодействии с интерфейсом:
`catalogCard:pressed` - нажатие карточки товара на главной странице.\
`cardPreviewButton:pressed` - нажатие кнопки в подробной карточке товара (кнопка добавления / удаления товара).\
`basketCardButton:pressed` - нажатие кнопки карточки товара в корзине (кнопка удаления товара).\
`basketIcon:pressed` - нажатие иконки корзины.\
`basket:submit` - сабмит корзины (нажатие кнопки "Оформить")\
`orderForm:submit` - сабмит формы со способом оплаты и адресом.\
`contactsForm:submit` - сабмит формы с email и номером телефона.\
`orderForm:changed` - изменение в элементах формы со способом оплаты и адресом.\
`contactsData:changed` - изменение в элементах формы с email и номером телефона.\
`sucсessButton:pressed` - нажатие кнопки в окне с сообщением об отправке заказа.\
`modal:open` - открытие модального окна.\
`modal:close` - закрытие модального окна.

### Пример:
1. Пользователь жмет в корзине кнопку "Оформить", создаётся событие `basket:submit`.
2. В объект заказа записываются данные о товарах в корзине и общей сумме заказа, создаётся событие `basketData:changed`.
3. В модальном окне рендерится форма с выбором типа оплаты и адресом.
4. При нажатии кнопки с типом оплаты или при заполнении поля с адресом создается событие `orderForm:changed`, в котором передаются данные о полях и кнопках формы.
5. Вызывается метод валидатора для проверки валидности формы, создаётся событие `orderForm:checked` с результатами проверки валидности. Обработка события меняет текст ошибки и статус блокировки кнопки сабмита формы. Если форма валидна - кнопка разблокируется.



